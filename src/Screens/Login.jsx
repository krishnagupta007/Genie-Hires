import React, {useState} from "react";
import { Link, useNavigate } from "react-router-dom";
import "../Screens/Login.css";
import "../global.css";  
import { ToastContainer, toast } from 'react-toastify';
import 'react-toastify/dist/ReactToastify.css';
import { useGoogleLogin } from '@react-oauth/google';

export const Login = () => {
const navigate = useNavigate();

const navigateHome = () => {
    navigate('/');
}

const handleGoogleLogin = useGoogleLogin({
    onSuccess: async (Response) => {
    await fetch('https://console.cloud.google.com/api/userinfo', {
        method:"GET",
        headers:{ 
            Authorization: `Bearer ${Response.access_token}`,
            'Content-Type': 'application/json'        
        },
        mode: 'no-cors',
    });
        toast.success("Log In Success")
        localStorage.setItem("authToken", Response.access_token)
        setInterval(() => {
            navigate("/")
        }, 3000);
    },

    onError: errorResponse => console.log(errorResponse),
});


const [data, setData] = useState({ email: "", password: "" });

const handleChange = ({ currentTarget: input }) => {
    setData({ ...data, [input.name]: input.value });
};

const handleSubmit = async (e) => {
    e.preventDefault();

    if(!data.email && !data.password) toast.warn("Please Login Using Valid Credentials") 
    else {
        if(!data.email) toast.warn("Please Enter Your Email Address")
        if(!data.password) toast.warn("Please Enter Your Password")
    }

    // Email Validation
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (data.email && !re.test(data.email)){
        toast.warn("Please Enter a Valid Email Address")
    } 

    const response = await fetch("http://localhost:5000/api/loginuser",{
        method:"POST",
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            email: data.email,
            password: data.password
        })
    });

    if(data.password && response.status === 405) toast.warn("Incorrect Password")

    if(re.test(data.email) && data.password && response.status === 400){
        toast.warn("No Such User Found. Sign Up Instead")
    }

    const Responsejson = await response.json();
    if(Responsejson.success){
        toast.success("Log In Success")

        localStorage.setItem("authToken", Responsejson.authToken)

        setTimeout(() => {
            navigate("/")
        }, 3000);
    }
};


return (
    <>
    <img id="LeftLogo" src="/Images/Logo.png" alt="" onClick={navigateHome}></img>

    <ToastContainer
        position="top-right"
        autoClose={2000}
        hideProgressBar={false}
        newestOnTop={false}
        closeOnClick
        rtl={false}
        pauseOnFocusLoss
        draggable
        theme="colored"
        />

    <div className="form">
        <form onSubmit={handleSubmit}>
        <h1 id="maintext">Log In to Genie Hire's</h1>

        <div className="inputbox">
            <label htmlFor="email">Email</label>
            <input
            name="email"
            value={data.email}
            onChange={handleChange}
            type="email"
            placeholder="Enter your Email Address"
            required
            ></input>
        </div>

        <div className="inputbox">
            <label htmlFor="password">Password</label>
            <input
            name="password"
            value={data.password}
            onChange={handleChange}
            type="password"
            placeholder="Enter your Password"
            minLength={8}
            maxLength={16}
            required
            ></input>
            <Link to="/forgotpassword">Forgot Password ? </Link>
        </div>

        <div className="inputbox">
        <button id="loginbtn" type="submit" onClick={handleSubmit}> Log In </button>
        <Link to="/signup">Don't Have An Account? Sign Up Instead</Link>
        </div>

        <div className="loginoptions">
            <svg
            width="550"
            height="34"
            viewBox="0 0 670 34"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            >
            <path
                d="M219.636 26.6687C217.828 26.6687 216.236 26.3087 214.86 25.5887C213.5 24.8527 212.444 23.8207 211.692 22.4927C210.956 21.1647 210.588 19.6207 210.588 17.8607C210.588 16.1007 210.956 14.5567 211.692 13.2287C212.444 11.9007 213.5 10.8767 214.86 10.1567C216.236 9.42074 217.828 9.05274 219.636 9.05274C221.444 9.05274 223.028 9.42074 224.388 10.1567C225.764 10.8767 226.82 11.9007 227.556 13.2287C228.308 14.5567 228.684 16.1007 228.684 17.8607C228.684 19.6207 228.308 21.1647 227.556 22.4927C226.82 23.8207 225.764 24.8527 224.388 25.5887C223.028 26.3087 221.444 26.6687 219.636 26.6687ZM219.636 23.1647C220.644 23.1647 221.532 22.9487 222.3 22.5167C223.084 22.0687 223.684 21.4447 224.1 20.6447C224.532 19.8447 224.748 18.9167 224.748 17.8607C224.748 16.8047 224.532 15.8767 224.1 15.0767C223.684 14.2767 223.084 13.6607 222.3 13.2287C221.532 12.7807 220.644 12.5567 219.636 12.5567C218.628 12.5567 217.74 12.7807 216.972 13.2287C216.204 13.6607 215.604 14.2767 215.172 15.0767C214.756 15.8767 214.548 16.8047 214.548 17.8607C214.548 18.9167 214.756 19.8447 215.172 20.6447C215.604 21.4447 216.204 22.0687 216.972 22.5167C217.74 22.9487 218.628 23.1647 219.636 23.1647ZM239.464 25.8047C238.536 26.2687 237.488 26.5007 236.32 26.5007C235.024 26.5007 234 26.1407 233.248 25.4207C232.496 24.6847 232.12 23.5087 232.12 21.8927V17.4047H230.104V14.4047H232.12V11.4527L235.864 11.0447V14.4047H238.816V17.4047H235.864V21.8927C235.864 22.3727 235.984 22.7327 236.224 22.9727C236.464 23.1967 236.792 23.3087 237.208 23.3087C237.672 23.3087 238.128 23.1967 238.576 22.9727L239.464 25.8047ZM248.532 14.1407C249.988 14.1407 251.14 14.6287 251.988 15.6047C252.852 16.5807 253.284 17.9007 253.284 19.5647V26.2607H249.516V19.7807C249.516 19.0127 249.324 18.4127 248.94 17.9807C248.572 17.5487 248.052 17.3327 247.38 17.3327C246.644 17.3327 246.044 17.5807 245.58 18.0767C245.132 18.5727 244.908 19.2207 244.908 20.0207V26.2607H241.14V9.46074H244.908V15.7007C245.82 14.6607 247.028 14.1407 248.532 14.1407ZM261.688 14.1407C262.984 14.1407 264.104 14.3887 265.048 14.8847C265.992 15.3647 266.712 16.0527 267.208 16.9487C267.72 17.8287 267.976 18.8607 267.976 20.0447C267.976 20.4287 267.936 20.9007 267.856 21.4607H259.144C259.256 22.0687 259.584 22.5647 260.128 22.9487C260.672 23.3167 261.368 23.5007 262.216 23.5007C262.808 23.5007 263.384 23.4127 263.944 23.2367C264.504 23.0607 264.984 22.8127 265.384 22.4927L267.352 24.6047C266.68 25.2287 265.88 25.7087 264.952 26.0447C264.04 26.3807 263.064 26.5487 262.024 26.5487C260.648 26.5487 259.456 26.3007 258.448 25.8047C257.44 25.2927 256.664 24.5727 256.12 23.6447C255.576 22.7167 255.304 21.6207 255.304 20.3567C255.304 19.1407 255.568 18.0607 256.096 17.1167C256.64 16.1727 257.392 15.4447 258.352 14.9327C259.312 14.4047 260.424 14.1407 261.688 14.1407ZM261.808 17.1167C261.056 17.1167 260.44 17.3087 259.96 17.6927C259.496 18.0767 259.232 18.6127 259.168 19.3007H264.4C264.352 18.6127 264.096 18.0767 263.632 17.6927C263.184 17.3087 262.576 17.1167 261.808 17.1167ZM276.806 14.1407C277.35 14.1407 277.894 14.2447 278.438 14.4527C278.982 14.6447 279.454 14.9327 279.854 15.3167L278.27 18.0767C277.934 17.8687 277.622 17.7167 277.334 17.6207C277.046 17.5247 276.742 17.4767 276.422 17.4767C275.622 17.4767 274.99 17.7327 274.526 18.2447C274.062 18.7567 273.83 19.5087 273.83 20.5007V26.2607H270.062V14.4047H273.35L273.638 15.8927C274.406 14.7247 275.462 14.1407 276.806 14.1407ZM286.571 9.46074H290.507V22.7087H298.955V26.2607H286.571V9.46074ZM306.433 26.5247C305.121 26.5247 303.969 26.2687 302.977 25.7567C302.001 25.2287 301.249 24.5007 300.721 23.5727C300.193 22.6447 299.929 21.5647 299.929 20.3327C299.929 19.1007 300.193 18.0207 300.721 17.0927C301.249 16.1647 302.001 15.4447 302.977 14.9327C303.969 14.4047 305.121 14.1407 306.433 14.1407C307.745 14.1407 308.897 14.4047 309.889 14.9327C310.881 15.4447 311.641 16.1647 312.169 17.0927C312.697 18.0207 312.961 19.1007 312.961 20.3327C312.961 21.5647 312.697 22.6447 312.169 23.5727C311.641 24.5007 310.881 25.2287 309.889 25.7567C308.897 26.2687 307.745 26.5247 306.433 26.5247ZM306.433 23.3327C307.265 23.3327 307.937 23.0527 308.449 22.4927C308.961 21.9327 309.217 21.2127 309.217 20.3327C309.217 19.4527 308.961 18.7327 308.449 18.1727C307.937 17.6127 307.265 17.3327 306.433 17.3327C305.617 17.3327 304.953 17.6127 304.441 18.1727C303.929 18.7327 303.673 19.4527 303.673 20.3327C303.673 21.2127 303.929 21.9327 304.441 22.4927C304.953 23.0527 305.617 23.3327 306.433 23.3327ZM324.996 24.3167C325.796 24.6847 326.412 25.1967 326.844 25.8527C327.292 26.4927 327.516 27.2367 327.516 28.0847C327.516 29.0767 327.244 29.9487 326.7 30.7007C326.156 31.4687 325.388 32.0527 324.396 32.4527C323.404 32.8687 322.252 33.0767 320.94 33.0767C319.66 33.0767 318.54 32.8687 317.58 32.4527C316.62 32.0367 315.876 31.4447 315.348 30.6767C314.836 29.9087 314.58 29.0207 314.58 28.0127C314.58 27.7567 314.588 27.5647 314.604 27.4367H318.228C318.196 28.2207 318.412 28.8287 318.876 29.2607C319.356 29.6927 320.044 29.9087 320.94 29.9087C321.74 29.9087 322.388 29.7247 322.884 29.3567C323.38 29.0047 323.628 28.5327 323.628 27.9407C323.628 27.3327 323.396 26.8607 322.932 26.5247C322.484 26.2047 321.836 26.0447 320.988 26.0447C319.676 26.0447 318.524 25.7967 317.532 25.3007C316.556 24.8047 315.796 24.1087 315.252 23.2127C314.724 22.3007 314.46 21.2447 314.46 20.0447C314.46 18.8927 314.732 17.8687 315.276 16.9727C315.836 16.0607 316.604 15.3567 317.58 14.8607C318.572 14.3487 319.7 14.0927 320.964 14.0927C321.94 14.0927 322.836 14.2847 323.652 14.6687L325.044 12.9407L327.804 14.9327L326.22 16.7807C327.02 17.6927 327.42 18.7807 327.42 20.0447C327.42 20.9247 327.204 21.7407 326.772 22.4927C326.356 23.2287 325.764 23.8367 324.996 24.3167ZM320.964 22.8527C321.796 22.8527 322.468 22.5967 322.98 22.0847C323.492 21.5727 323.748 20.8927 323.748 20.0447C323.748 19.1967 323.492 18.5247 322.98 18.0287C322.484 17.5167 321.812 17.2607 320.964 17.2607C320.132 17.2607 319.46 17.5167 318.948 18.0287C318.436 18.5247 318.18 19.1967 318.18 20.0447C318.18 20.8767 318.436 21.5567 318.948 22.0847C319.46 22.5967 320.132 22.8527 320.964 22.8527ZM335.907 9.46074H339.843V26.2607H335.907V9.46074ZM350.319 14.1407C351.791 14.1407 352.959 14.6207 353.823 15.5807C354.703 16.5407 355.143 17.8687 355.143 19.5647V26.2607H351.375V19.7807C351.375 19.0127 351.183 18.4127 350.799 17.9807C350.415 17.5487 349.887 17.3327 349.215 17.3327C348.479 17.3327 347.887 17.5807 347.439 18.0767C346.991 18.5727 346.767 19.2207 346.767 20.0207V26.2607H342.999V14.4047H346.263L346.503 15.7967C346.967 15.2687 347.519 14.8607 348.159 14.5727C348.815 14.2847 349.535 14.1407 350.319 14.1407ZM371.956 26.6687C370.148 26.6687 368.556 26.3087 367.18 25.5887C365.82 24.8527 364.764 23.8207 364.012 22.4927C363.276 21.1647 362.908 19.6207 362.908 17.8607C362.908 16.1007 363.276 14.5567 364.012 13.2287C364.764 11.9007 365.82 10.8767 367.18 10.1567C368.556 9.42074 370.148 9.05274 371.956 9.05274C373.764 9.05274 375.348 9.42074 376.708 10.1567C378.084 10.8767 379.14 11.9007 379.876 13.2287C380.628 14.5567 381.004 16.1007 381.004 17.8607C381.004 19.6207 380.628 21.1647 379.876 22.4927C379.14 23.8207 378.084 24.8527 376.708 25.5887C375.348 26.3087 373.764 26.6687 371.956 26.6687ZM371.956 23.1647C372.964 23.1647 373.852 22.9487 374.62 22.5167C375.404 22.0687 376.004 21.4447 376.42 20.6447C376.852 19.8447 377.068 18.9167 377.068 17.8607C377.068 16.8047 376.852 15.8767 376.42 15.0767C376.004 14.2767 375.404 13.6607 374.62 13.2287C373.852 12.7807 372.964 12.5567 371.956 12.5567C370.948 12.5567 370.06 12.7807 369.292 13.2287C368.524 13.6607 367.924 14.2767 367.492 15.0767C367.076 15.8767 366.868 16.8047 366.868 17.8607C366.868 18.9167 367.076 19.8447 367.492 20.6447C367.924 21.4447 368.524 22.0687 369.292 22.5167C370.06 22.9487 370.948 23.1647 371.956 23.1647ZM390.541 14.1647C391.645 14.1647 392.629 14.4287 393.493 14.9567C394.357 15.4687 395.029 16.1967 395.509 17.1407C395.989 18.0687 396.229 19.1327 396.229 20.3327C396.229 21.5327 395.989 22.6047 395.509 23.5487C395.029 24.4767 394.357 25.2047 393.493 25.7327C392.629 26.2447 391.645 26.5007 390.541 26.5007C389.069 26.5007 387.845 26.0367 386.869 25.1087V31.3967H383.101V14.4047H386.365L386.605 15.7967C387.597 14.7087 388.909 14.1647 390.541 14.1647ZM389.653 23.3327C390.485 23.3327 391.165 23.0607 391.693 22.5167C392.221 21.9567 392.485 21.2287 392.485 20.3327C392.485 19.4367 392.221 18.7167 391.693 18.1727C391.165 17.6127 390.485 17.3327 389.653 17.3327C388.821 17.3327 388.141 17.6127 387.613 18.1727C387.101 18.7327 386.845 19.4527 386.845 20.3327C386.845 21.2127 387.101 21.9327 387.613 22.4927C388.141 23.0527 388.821 23.3327 389.653 23.3327ZM406.737 25.8047C405.809 26.2687 404.761 26.5007 403.593 26.5007C402.297 26.5007 401.273 26.1407 400.521 25.4207C399.769 24.6847 399.393 23.5087 399.393 21.8927V17.4047H397.377V14.4047H399.393V11.4527L403.137 11.0447V14.4047H406.089V17.4047H403.137V21.8927C403.137 22.3727 403.257 22.7327 403.497 22.9727C403.737 23.1967 404.065 23.3087 404.481 23.3087C404.945 23.3087 405.401 23.1967 405.849 22.9727L406.737 25.8047ZM410.309 13.2287C409.653 13.2287 409.117 13.0367 408.701 12.6527C408.301 12.2687 408.101 11.7807 408.101 11.1887C408.101 10.5807 408.309 10.0847 408.725 9.70074C409.141 9.31674 409.669 9.12474 410.309 9.12474C410.949 9.12474 411.477 9.31674 411.893 9.70074C412.309 10.0847 412.517 10.5807 412.517 11.1887C412.517 11.7807 412.309 12.2687 411.893 12.6527C411.493 13.0367 410.965 13.2287 410.309 13.2287ZM408.413 14.4047H412.181V26.2607H408.413V14.4047ZM420.855 26.5247C419.543 26.5247 418.391 26.2687 417.399 25.7567C416.423 25.2287 415.671 24.5007 415.143 23.5727C414.615 22.6447 414.351 21.5647 414.351 20.3327C414.351 19.1007 414.615 18.0207 415.143 17.0927C415.671 16.1647 416.423 15.4447 417.399 14.9327C418.391 14.4047 419.543 14.1407 420.855 14.1407C422.167 14.1407 423.319 14.4047 424.311 14.9327C425.303 15.4447 426.063 16.1647 426.591 17.0927C427.119 18.0207 427.383 19.1007 427.383 20.3327C427.383 21.5647 427.119 22.6447 426.591 23.5727C426.063 24.5007 425.303 25.2287 424.311 25.7567C423.319 26.2687 422.167 26.5247 420.855 26.5247ZM420.855 23.3327C421.687 23.3327 422.359 23.0527 422.871 22.4927C423.383 21.9327 423.639 21.2127 423.639 20.3327C423.639 19.4527 423.383 18.7327 422.871 18.1727C422.359 17.6127 421.687 17.3327 420.855 17.3327C420.039 17.3327 419.375 17.6127 418.863 18.1727C418.351 18.7327 418.095 19.4527 418.095 20.3327C418.095 21.2127 418.351 21.9327 418.863 22.4927C419.375 23.0527 420.039 23.3327 420.855 23.3327ZM436.874 14.1407C438.346 14.1407 439.514 14.6207 440.378 15.5807C441.258 16.5407 441.698 17.8687 441.698 19.5647V26.2607H437.93V19.7807C437.93 19.0127 437.738 18.4127 437.354 17.9807C436.97 17.5487 436.442 17.3327 435.77 17.3327C435.034 17.3327 434.442 17.5807 433.994 18.0767C433.546 18.5727 433.322 19.2207 433.322 20.0207V26.2607H429.554V14.4047H432.818L433.058 15.7967C433.522 15.2687 434.074 14.8607 434.714 14.5727C435.37 14.2847 436.09 14.1407 436.874 14.1407ZM448.998 26.5727C446.902 26.5727 445.078 26.0447 443.526 24.9887L444.966 22.3967C445.542 22.7487 446.206 23.0207 446.958 23.2127C447.726 23.4047 448.486 23.5007 449.238 23.5007C450.278 23.5007 450.798 23.2207 450.798 22.6607C450.798 22.3727 450.654 22.1567 450.366 22.0127C450.078 21.8687 449.598 21.7727 448.926 21.7247C447.422 21.6447 446.222 21.2687 445.326 20.5967C444.446 19.9247 444.006 19.0447 444.006 17.9567C444.006 16.7727 444.486 15.8367 445.446 15.1487C446.406 14.4447 447.702 14.0927 449.334 14.0927C450.262 14.0927 451.142 14.2047 451.974 14.4287C452.822 14.6527 453.55 14.9647 454.158 15.3647L452.694 17.8847C451.798 17.3727 450.734 17.1167 449.502 17.1167C448.286 17.1167 447.678 17.4047 447.678 17.9807C447.678 18.2207 447.798 18.4047 448.038 18.5327C448.294 18.6607 448.718 18.7567 449.31 18.8207C451.006 18.9487 452.294 19.3327 453.174 19.9727C454.07 20.6127 454.518 21.5087 454.518 22.6607C454.518 23.8767 454.03 24.8367 453.054 25.5407C452.078 26.2287 450.726 26.5727 448.998 26.5727Z"
                fill="black"
            />
            <path
                d="M3.8799 17.5221H15.5199V20.5941H3.8799V17.5221ZM15.3877 17.5221H27.0277V20.5941H15.3877V17.5221ZM26.8955 17.5221H38.5355V20.5941H26.8955V17.5221ZM38.4033 17.5221H50.0433V20.5941H38.4033V17.5221ZM49.9111 17.5221H61.5511V20.5941H49.9111V17.5221ZM61.419 17.5221H73.059V20.5941H61.419V17.5221ZM72.9268 17.5221H84.5668V20.5941H72.9268V17.5221ZM84.4346 17.5221H96.0746V20.5941H84.4346V17.5221ZM95.9424 17.5221H107.582V20.5941H95.9424V17.5221ZM107.45 17.5221H119.09V20.5941H107.45V17.5221ZM118.958 17.5221H130.598V20.5941H118.958V17.5221ZM130.466 17.5221H142.106V20.5941H130.466V17.5221ZM141.974 17.5221H153.614V20.5941H141.974V17.5221ZM153.481 17.5221H165.121V20.5941H153.481V17.5221ZM164.989 17.5221H176.629V20.5941H164.989V17.5221ZM176.497 17.5221H188.137V20.5941H176.497V17.5221Z"
                fill="black"
            />
            <path
                d="M481.861 17.5221H493.501V20.5941H481.861V17.5221ZM493.369 17.5221H505.009V20.5941H493.369V17.5221ZM504.877 17.5221H516.517V20.5941H504.877V17.5221ZM516.385 17.5221H528.025V20.5941H516.385V17.5221ZM527.893 17.5221H539.533V20.5941H527.893V17.5221ZM539.4 17.5221H551.04V20.5941H539.4V17.5221ZM550.908 17.5221H562.548V20.5941H550.908V17.5221ZM562.416 17.5221H574.056V20.5941H562.416V17.5221ZM573.924 17.5221H585.564V20.5941H573.924V17.5221ZM585.432 17.5221H597.072V20.5941H585.432V17.5221ZM596.939 17.5221H608.579V20.5941H596.939V17.5221ZM608.447 17.5221H620.087V20.5941H608.447V17.5221ZM619.955 17.5221H631.595V20.5941H619.955V17.5221ZM631.463 17.5221H643.103V20.5941H631.463V17.5221ZM642.971 17.5221H654.611V20.5941H642.971V17.5221ZM654.479 17.5221H666.119V20.5941H654.479V17.5221Z"
                fill="black"
            />
            </svg>
        </div>
        
        </form>
            <button 
            id="googlelogin"
            onClick={handleGoogleLogin}
            style={{cursor: "pointer"}}
            >
            <img id="google" src="/Images/Google.png" alt=""></img>
            <label htmlFor="googlelogin" style={{cursor: "pointer"}}>Log In With Google</label>
            </button>
    </div>
    </>
);
};
